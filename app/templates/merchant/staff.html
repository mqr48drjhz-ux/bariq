{% extends "merchant/layout.html" %}

{% block title %}Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ† - Ø§Ù„ØªØ§Ø¬Ø±{% endblock %}

{% block page_content %}
<div class="card">
  <div class="card-header">
    <h2 style="font-size: 1.5rem; margin: 0;">Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†</h2>
  </div>

  <div id="staff-content">
    <div class="loading-container">
      <div class="spinner"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
  async function loadStaff() {
    const container = document.getElementById('staff-content');

    try {
      const result = await API.merchant.getStaff();
      console.log('Staff API result:', result);

      // Safely extract staff array
      let staff = [];
      if (result.success && result.data?.data?.staff && Array.isArray(result.data.data.staff)) {
        staff = result.data.data.staff;
      } else if (result.success && Array.isArray(result.data?.data)) {
        staff = result.data.data;
      }
      console.log('Staff extracted:', staff);

      if (staff.length === 0) {
        container.innerHTML = `
          <div class="text-center p-6 text-muted">
            <span style="font-size: 3rem;">ğŸ‘¥</span>
            <p class="mt-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙˆÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                <th>Ø§Ù„Ø¯ÙˆØ±</th>
                <th>Ø§Ù„ÙØ±Ø¹</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              </tr>
            </thead>
            <tbody>
              ${staff.map(s => `
                <tr>
                  <td>${s.full_name || '-'}</td>
                  <td style="direction: ltr;">${s.email || '-'}</td>
                  <td>${s.role || '-'}</td>
                  <td>${s.branch?.name_ar || 'Ø§Ù„ÙƒÙ„'}</td>
                  <td><span class="badge ${getStatusBadgeClass(s.status)}">${getStatusLabel(s.status)}</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;

    } catch (error) {
      console.error('Error loading staff:', error);
      showError(container, 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
    }
  }

  document.addEventListener('DOMContentLoaded', loadStaff);
</script>
{% endblock %}