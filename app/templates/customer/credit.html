{% extends "customer/layout.html" %}

{% block title %}Ø­Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡ - Ø¨Ø±ÙŠÙ‚ Ø§Ù„ÙŠØ³Ø±{% endblock %}

{% block page_content %}
<div id="credit-content">
    <div class="loading-container">
        <div class="spinner"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
    async function loadCreditPage() {
        const container = document.getElementById('credit-content');

        try {
            const result = await API.customer.getCredit();
            const credit = result.data?.data || {};

            container.innerHTML = `
        <div class="grid grid-3 mb-6">
          <div class="stat-card green">
            <div class="stat-card-header">
              <span>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ§Ø­Ø©</span>
              <span style="font-size: 2rem;">ğŸ’³</span>
            </div>
            <div class="stat-card-value">${formatNumber(credit.available_credit || 0)}</div>
            <div class="stat-card-label">Ù†Ù‚Ø·Ø©</div>
          </div>
          
          <div class="stat-card gold">
            <div class="stat-card-header">
              <span>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</span>
              <span style="font-size: 2rem;">ğŸ“Š</span>
            </div>
            <div class="stat-card-value">${formatNumber(credit.used_credit || 0)}</div>
            <div class="stat-card-label">Ù†Ù‚Ø·Ø©</div>
          </div>
          
          <div class="stat-card dark">
            <div class="stat-card-header">
              <span>Ø­Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠ</span>
              <span style="font-size: 2rem;">ğŸ¯</span>
            </div>
            <div class="stat-card-value">${formatNumber(credit.credit_limit || 0)}</div>
            <div class="stat-card-label">Ù†Ù‚Ø·Ø©</div>
          </div>
        </div>
        
        <div class="card mb-6">
          <h3>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
          <div style="background: var(--gray-100); border-radius: var(--radius-lg); height: 24px; margin-bottom: var(--space-4);">
            <div style="background: linear-gradient(135deg, var(--primary-500), var(--primary-600)); height: 100%; border-radius: var(--radius-lg); width: ${Math.round((credit.used_credit || 0) / (credit.credit_limit || 1) * 100)}%;"></div>
          </div>
          <div class="flex justify-between text-sm text-muted">
            <span>Ù…Ø³ØªØ®Ø¯Ù…: ${formatNumber(credit.used_credit || 0)} Ù†Ù‚Ø·Ø©</span>
            <span>Ù…ØªØ§Ø­: ${formatNumber(credit.available_credit || 0)} Ù†Ù‚Ø·Ø©</span>
          </div>
        </div>
        
        <div class="card">
          <h3>Ø·Ù„Ø¨ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¯</h3>
          <p class="text-muted mb-4">ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ù„Ø¨ Ø²ÙŠØ§Ø¯Ø© Ø­Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©.</p>
          <form onsubmit="requestCreditIncrease(event)">
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ù†Ù‚Ø·Ø©)</label>
              <input type="number" id="requested-amount" class="form-input" dir="ltr" placeholder="Ù…Ø«Ø§Ù„: 5000" required min="100">
            </div>
            <div class="form-group">
              <label class="form-label">Ø³Ø¨Ø¨ Ø§Ù„Ø·Ù„Ø¨</label>
              <textarea id="request-reason" class="form-input" rows="3" placeholder="Ø§Ø´Ø±Ø­ Ù„Ù…Ø§Ø°Ø§ ØªØ­ØªØ§Ø¬ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¯..."></textarea>
            </div>
            <button type="submit" id="submit-btn" class="btn btn-primary">
              Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
            </button>
          </form>
        </div>
      `;

        } catch (error) {
            console.error('Error loading credit:', error);
            showError(container, 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
    }

    async function requestCreditIncrease(event) {
        event.preventDefault();
        const amount = document.getElementById('requested-amount').value;
        const reason = document.getElementById('request-reason').value;
        const btn = document.getElementById('submit-btn');

        btn.disabled = true;
        btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

        try {
            const result = await API.customer.getCredit(); // TODO: Call actual request credit API
            alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³Ù†Ø±Ø§Ø¬Ø¹Ù‡ ÙˆÙ†Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
            loadCreditPage();
        } catch (error) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨';
        }
    }

    document.addEventListener('DOMContentLoaded', loadCreditPage);
</script>
{% endblock %}